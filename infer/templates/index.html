<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>calci-infer</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript"> 
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function transposeArray(array) {
            
            var transposedArray = [];
        
            var numRows = array.length;
            if (numRows === 0){
                return transposedArray;
            }
            var numCols = array[0].length;
        
            for (var j = 0; j < numCols; j++) {
                var column = [];
                for (var i = 0; i < numRows; i++) {
                    column.push(array[i][j]);
                }
                transposedArray.push(column);
            }
        
            return transposedArray;
        }
        
        function drawChart() {

            var coords = JSON.parse({{ chart_data | tojson }})
            console.log(coords);

            if (coords.length > 0 ){
                var data = new google.visualization.DataTable();
                var calci = []
                for (var key in coords ){
                    column = coords[key]
                    console.log(column)
                    data.addColumn("number", column[0]);
                    calci.push(column[1])
                }
                
                data.addRows(transposeArray(calci))
                
                var options = {
                title: 'Calcimetry versus position',
                vAxis: {title: 'Calcimetry', minValue: 0, maxValue: 100},
                hAxis: {title: 'Position'}
                };

                var chart = new google.visualization.ScatterChart(document.getElementById('chart'));

                chart.draw(data, options);
            }
        }

    </script>
        
    <style type="text/css">
        #imageDisplay {
            width: 100%; /* Largeur de l'image = 100% de la largeur du div */
            height: 100%; /* Hauteur de l'image = 100% de la hauteur du div */
            object-fit: contain; /* Pour s'assurer que l'image s'adapte correctement au div */
        }
        .tg  {border-collapse:collapse;border-color:black;border-spacing:0;border-style:solid;border-width:1px;}
        .tg td{border-style:solid;border-width:0px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;
                padding:10px 5px;word-break:normal;}
        .tg th{border-style:solid;border-width:0px;font-family:Arial, sans-serif;font-size:14px;font-weight:normal;
                overflow:hidden;padding:10px 5px;word-break:normal;}
        .tg .tg-ur59{border-color:#343434;text-align:left;vertical-align:top}
    </style>
</head>

<body>
    <script type="text/javascript" src="/calcipredict/static-js"></script>
  
    <nav class="navbar bg-primary" data-bs-theme="dark">
        <div class="container-fluid"><a class="navbar-brand" href="#">Calcimétrie</a></div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <section class="py-4 py-xl-5">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                
                                <label for="fileInput" class="btn btn-primary" type="button" style="margin-left: 20px">File</label>
                                <input id="fileInput" accept="image/*" onchange="handleFile()" type="file" style="display: none;">
                                <label>{{filename}}</label>
                               </div>
                        </div>
                        <hr>
                    </div>
                </section>
            </div>
        </div>
        <div class="row row-cols-2">
            <div class="col-md-6"> 
                <img id="imageDisplay" src="data:image/jpeg;base64,{{ image }}" onclick="onClickEvent(event)">
            </div>
            <div class="col-md-6">
                <p>Clickez les centres des vignettes sur l'image</p>
                <div>
                    <table class="tg">
                        <tbody>
                            
                            <tr>
                                <td class="tg-ur59"><b>X</b></td>
                                {% for c in coords %}
                                <td class="tg-ur59">{{c[0]}}</td>
                                {% endfor %}
                            </tr>
                            <tr>
                                <td class="tg-ur59"><b>Y</b></td>
                                {% for c in coords %}
                                <td class="tg-ur59">{{c[1]}}</td>
                                {% endfor %}
                            </tr>
                           
                           
                        </tbody>
                    </table>
                </div><input id="clear_btn" class="btn btn-primary" type="button" value="Clear" onclick="handleClear()" style="margin-top: 20px; margin-bottom: 20px"/>
            </div>
        </div>
        <div class="row">
            <hr  style="margin-top: 20px; margin-bottom: 20px"/>
            <div class="col-md-12">
                <button id="compute_btn" 
                class="btn btn-primary"
                style="margin-bottom: 20px"
                onclick="handleCompute()"/>Compute</button></div>
            <div id="chart" ></div>
        </div>
    </div>
    <footer class="text-center py-4">
        <div class="container">
            <div class="row row-cols-1 row-cols-lg-3">
                <div class="col">
                    <p class="text-muted my-2">Copyright&nbsp;© 2024 IFPEN</p>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" ></script>
</body>

</html>